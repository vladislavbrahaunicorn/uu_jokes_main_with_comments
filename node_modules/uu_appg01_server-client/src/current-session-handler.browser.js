"use strict";

const { AuthenticationService } = require("uu_appg01_oidc");

/**
 * Interceptor providing current session from global environment in case custom
 * session is not given via app client instance or call parameters.
 */
class CurrentSessionHandler {
  constructor(next, options = null) {
    this._next = next;
    this._options = options || {};
  }

  async invoke(request, options = null) {
    let opts = Object.assign(this._options, options);
    if (!opts.session) {
      if (!options) {
        options = {};
      }
      options.session = AuthenticationService.getCurrentSession();
    }
    return this._next.invoke(request, options);
  }
}

module.exports = CurrentSessionHandler;
