const paths = require("../config/paths.js");
const fs = require("fs-extra");
const shell = require("shelljs");

module.exports = class Clean {
  constructor(config) {
    this.config = config;
  }
  async process() {
    console.log("Cleaning build directory.");
    require("./webpack/runner.js").mergeBuildConfig(this.config);
    if (this.config.get("outputPath")) fs.emptyDirSync(this.config.get("outputPath")); // keep folder if it's web server's public/
    shell.rm(
      "-rf",
      paths.buildDir,
      paths.npmPackTranspiledWebLibDir,
      paths.npmPackTranspiledNodeLibDir,
      paths.npmPackEsmDir
    );
  }
};
