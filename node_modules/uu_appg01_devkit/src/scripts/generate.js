const path = require("path");
const helpers = require("../tools/helpers.js");

module.exports = class Deploy {
  constructor(config) {
    this.config = config;
  }
  async process() {
    let templateType = helpers.getTemplateInfo().type;
    if (templateType.startsWith("uu5") && !this.config.get("skipExternalsDiscovery")) {
      const DependencyProcessor = require("./webpack/dependency-processor.js");
      let depProcessor = new DependencyProcessor("package.json");
      let externals = depProcessor.getExternals(templateType === "uu5-lib" ? "lib" : "app");
      this.config.set({ externals });
    }

    let Generate = helpers.requireByTemplateType(
      path.dirname(require.resolve("uu_appg01_devkit-common/package.json")) + "/src/scripts/generate.js"
    );
    return await new Generate(this.config).process();
  }
};
