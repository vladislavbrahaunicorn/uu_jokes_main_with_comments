const fs = require("fs");
const archiver = require("archiver");

function zip(outputPath, fn) {
  let output = fs.createWriteStream(outputPath);
  return new Promise(async function(resolve, reject) {
    let archive = archiver("zip", { zlib: { level: 9 } });
    archive.on("error", () => reject());
    archive.on("end", () => resolve());
    archive.pipe(output);
    await fn(archive);
    archive.finalize();
  });
}

module.exports = zip;
