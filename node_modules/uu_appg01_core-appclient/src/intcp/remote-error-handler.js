"use strict";

const ApplicationError = require("../error/application-error.js");
const SystemError = require("../error/system-error.js");

/**
 * Interceptor for extracting error information from response.
 */
class RemoteErrorHandler {
  constructor(next, options = null) {
    this._next = next;
  }

  async invoke(request, options = null) {
    // NOTE We assume that the "content-type" transformation has been already performed on response data.
    let response = await this._next.invoke(request, options);
    if (response.status >= 400) {
      let errorData = response.data || {};
      if (response.status < 500) {
        throw new ApplicationError(errorData, response);
      } else {
        throw new SystemError(errorData, response);
      }
    }
    return response;
  }
}

module.exports = RemoteErrorHandler;
